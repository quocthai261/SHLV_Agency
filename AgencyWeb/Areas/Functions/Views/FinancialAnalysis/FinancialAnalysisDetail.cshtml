@using AgencyWeb.Models
@using AgencyWeb.Areas.Functions.Controllers
@using Microsoft.AspNetCore.Mvc.Localization

@inject IHtmlLocalizer<FinancialAnalysisController> HtmlLocalizer

<div class="container-fluid p-0">
    <div class="row">
        <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6 card-summary-grid-left">
            <h1 class="h5 mb-3 form-title"><strong>Phân tích nhu cầu tài chính</strong></h1>
        </div>
    </div>

    <div class="row">
        <div class="col-12 col-md-12 col-xxl-6 d-flex order-3 order-xxl-2">
            <div class="card card-body form-control-ui">
                <div class="row button-right-row">
                    <div class="col-md-12">
                        <button class="btn btn-purple-style" type="submit" onclick="onPopupChooseCustomerClicked()">Chọn khách hàng</button>
                    </div>
                </div>
                <p>
                    <a class="form-title" data-bs-toggle="collapse" href="#collapse01" role="button" aria-expanded="false" aria-controls="collapseExample">
                        <strong>A. THÔNG TIN CHUNG</strong>
                    </a>
                </p>
                <div class="collapse show" id="collapse01">
                    <div class="row">
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().TextBox()
                                    .ElementAttr("class", "required-validation")
                                    .Label("Họ và tên (BMBH)").LabelMode(EditorLabelMode.Floating)
                                    .MaxLength(50).ShowClearButton(true)
                                    .Value("Vũ Trường Giang")
                                    )
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().SelectBox()
                                //.DataSource(d => d.WebApi().Area("Functions").Controller("Product").LoadAction("GetPaymodeList"))
                                    //.DisplayExpr("PayModeName")
                                    //.ValueExpr("PayModeID")
                                    .Placeholder("Chọn")
                                    .SearchEnabled(true).Label("Giới tính").LabelMode(EditorLabelMode.Floating)
                                    .ShowClearButton(true).ElementAttr("class", "required-validation")
                                    .DisplayExpr("Name")
                                    .ValueExpr("Code")
                                    .Value("1")
                                    .DataSource(new object[] {
                                new { Code = "1", Name = "Nam"},
                                new { Code = "2", Name = "Nữ"},
                                    }))
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().DateBox()
                                    .Type(DateBoxType.Date)
                                    .DisplayFormat("dd/MM/yyyy")
                                    .UseMaskBehavior(true)
                                    .Placeholder("dd/mm/yyyy")
                                    .Label("Ngày tháng năm sinh").LabelMode(EditorLabelMode.Floating)
                                    .ElementAttr("class", "required-validation").ShowClearButton(true)
                                    .Value(DateTime.Now.AddYears(-25))
                                    )
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().SelectBox()
                                //.DataSource(d => d.WebApi().Area("Functions").Controller("Product").LoadAction("GetPaymodeList"))
                                    //.DisplayExpr("PayModeName")
                                    //.ValueExpr("PayModeID")
                                    .Placeholder("Chọn")
                                    .SearchEnabled(true).Label("Loại giấy tờ tùy thân").LabelMode(EditorLabelMode.Floating)
                                    .ShowClearButton(true).ElementAttr("class", "required-validation")
                                    .DisplayExpr("Name")
                                    .ValueExpr("Code")
                                    .Value("1")
                                    .DataSource(new object[] {
                                new { Code = "1", Name = "Hộ chiếu"},
                                new { Code = "2", Name = "CCCD"},
                                    }))
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().TextBox()
                                    .ElementAttr("class", "required-validation")
                                    .Label("Số giấy tờ tùy thân").LabelMode(EditorLabelMode.Floating)
                                    .MaxLength(50).ShowClearButton(true)
                                    .Value("B0123456"))
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().DateBox()
                                    .Type(DateBoxType.Date)
                                    .DisplayFormat("dd/MM/yyyy")
                                    .UseMaskBehavior(true)
                                    .Placeholder("dd/mm/yyyy")
                                    .Label("Ngày cấp").LabelMode(EditorLabelMode.Floating)
                                    .ElementAttr("class", "required-validation").ShowClearButton(true)
                                    .Value(DateTime.Now.AddYears(-15)))
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().SelectBox()
                                //.DataSource(d => d.WebApi().Area("Functions").Controller("Product").LoadAction("GetPaymodeList"))
                                    //.DisplayExpr("PayModeName")
                                    //.ValueExpr("PayModeID")
                                    .Placeholder("Chọn")
                                    .SearchEnabled(true).Label("Nghề nghiệp/Chức vụ").LabelMode(EditorLabelMode.Floating)
                                    .ShowClearButton(true).ElementAttr("class", "required-validation")
                                    .DisplayExpr("Name")
                                    .ValueExpr("Code")
                                    .Value("1")
                                    .DataSource(new object[] {
                                new { Code = "1", Name = "Lập trình viên"},
                                new { Code = "2", Name = "Nhà Báo"},
                                    }))
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().SelectBox()
                                //.DataSource(d => d.WebApi().Area("Functions").Controller("Product").LoadAction("GetPaymodeList"))
                                    //.DisplayExpr("PayModeName")
                                    //.ValueExpr("PayModeID")
                                    .Placeholder("Chọn")
                                    .SearchEnabled(true).Label("Nhóm nghề nghiệp").LabelMode(EditorLabelMode.Floating)
                                    .ShowClearButton(true).ElementAttr("class", "required-validation")
                                    .DisplayExpr("Name")
                                    .ValueExpr("Code")
                                    .Value("1")
                                    .DataSource(new object[] {
                                new { Code = "1", Name = "Nhóm A"},
                                new { Code = "2", Name = "Nhóm B"},
                                    }))
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().NumberBox()
                                    .ElementAttr("class", "required-validation")
                                    .Label("Số người phụ thuộc").LabelMode(EditorLabelMode.Floating)
                                    .Min(50).Max(50).ShowClearButton(true)
                                    .Value(2).Format(Format.FixedPoint))
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().SelectBox()
                                //.DataSource(d => d.WebApi().Area("Functions").Controller("Product").LoadAction("GetPaymodeList"))
                                    //.DisplayExpr("PayModeName")
                                    //.ValueExpr("PayModeID")
                                    .Placeholder("Chọn")
                                    .SearchEnabled(true).Label("Nguồn thu nhập").LabelMode(EditorLabelMode.Floating)
                                    .ShowClearButton(true).ElementAttr("class", "required-validation")
                                    .DisplayExpr("Name")
                                    .ValueExpr("Code")
                                    .Value("1")
                                    .DataSource(new object[] {
                                new { Code = "1", Name = "Lương"},
                                new { Code = "2", Name = "Kinh doanh"},
                                new { Code = "3", Name = "Khác"},
                                    }))
                            </div>
                        </div>
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                            <div class="form-group">
                                @(Html.DevExtreme().CheckBox().Value(false).IconSize(18).ElementAttr("aria-label", "Custom size")
                                    .Text("Bên mua bảo hiểm là người được bảo hiểm"))
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().SelectBox()
                                //.DataSource(d => d.WebApi().Area("Functions").Controller("Product").LoadAction("GetPaymodeList"))
                                    //.DisplayExpr("PayModeName")
                                    //.ValueExpr("PayModeID")
                                    .Placeholder("Chọn")
                                    .SearchEnabled(true).Label("Mối quan hệ với BMBH").LabelMode(EditorLabelMode.Floating)
                                    .ShowClearButton(true).ElementAttr("class", "required-validation")
                                    .DisplayExpr("Name")
                                    .ValueExpr("Code")
                                    .Value("1")
                                    .DataSource(new object[] {
                                new { Code = "1", Name = "Vợ/Chồng"},
                                new { Code = "2", Name = "Anh/Em"},
                                    }))
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().TextBox()
                                    .ElementAttr("class", "required-validation")
                                    .Label("Họ và tên (NĐBH)").LabelMode(EditorLabelMode.Floating)
                                    .MaxLength(50).ShowClearButton(true)
                                    .Value("Cao Ngọc Lan"))
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().SelectBox()
                                //.DataSource(d => d.WebApi().Area("Functions").Controller("Product").LoadAction("GetPaymodeList"))
                                    //.DisplayExpr("PayModeName")
                                    //.ValueExpr("PayModeID")
                                    .Placeholder("Chọn")
                                    .SearchEnabled(true).Label("Giới tính").LabelMode(EditorLabelMode.Floating)
                                    .ShowClearButton(true).ElementAttr("class", "required-validation")
                                    .DisplayExpr("Name")
                                    .ValueExpr("Code")
                                    .Value("2")
                                    .DataSource(new object[] {
                                new { Code = "1", Name = "Nam"},
                                new { Code = "2", Name = "Nữ"},
                                    }))
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().DateBox()
                                    .Type(DateBoxType.Date)
                                    .DisplayFormat("dd/MM/yyyy")
                                    .UseMaskBehavior(true)
                                    .Placeholder("dd/mm/yyyy")
                                    .Label("Ngày tháng năm sinh").LabelMode(EditorLabelMode.Floating)
                                    .ElementAttr("class", "required-validation").ShowClearButton(true)
                                    .Value(DateTime.Now.AddYears(-25)))
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().SelectBox()
                                //.DataSource(d => d.WebApi().Area("Functions").Controller("Product").LoadAction("GetPaymodeList"))
                                    //.DisplayExpr("PayModeName")
                                    //.ValueExpr("PayModeID")
                                    .Placeholder("Chọn")
                                    .SearchEnabled(true).Label("Nghề nghiệp/Chức vụ").LabelMode(EditorLabelMode.Floating)
                                    .ShowClearButton(true).ElementAttr("class", "required-validation")
                                    .DisplayExpr("Name")
                                    .ValueExpr("Code")
                                    .Value("1")
                                    .DataSource(new object[] {
                                new { Code = "1", Name = "Kiến trúc sư"},
                                new { Code = "2", Name = "Họa viên 3D"},
                                    }))
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().SelectBox()
                                //.DataSource(d => d.WebApi().Area("Functions").Controller("Product").LoadAction("GetPaymodeList"))
                                    //.DisplayExpr("PayModeName")
                                    //.ValueExpr("PayModeID")
                                    .Placeholder("Chọn")
                                    .SearchEnabled(true).Label("Nhóm nghề nghiệp").LabelMode(EditorLabelMode.Floating)
                                    .ShowClearButton(true).ElementAttr("class", "required-validation")
                                    .DisplayExpr("Name")
                                    .ValueExpr("Code")
                                    .Value("1")
                                    .DataSource(new object[] {
                                new { Code = "1", Name = "Nhóm A"},
                                new { Code = "2", Name = "Nhóm B"},
                                    }))
                            </div>
                        </div>
                    </div>
                </div>
                <p>
                    <a class="form-title" data-bs-toggle="collapse" href="#collapse02" role="button" aria-expanded="false" aria-controls="collapseExample">
                        <strong>B. NHU CẦU VÀ KẾ HOẠCH TÀI CHÍNH</strong>
                    </a>
                </p>
                <div class="collapse show" id="collapse02">
                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                            <div class="form-group">
                                @(Html.DevExtreme().DataGrid<FinancialPlanModel>()
                                    .ID("gridFinancialPlan")
                                    .DataSource(d => d.WebApi()
                                    .Area("Functions")
                                    .Controller("FinancialAnalysis")
                                    .LoadAction("GetFinancialPlanList")
                                    )
                                    .ShowBorders(true)
                                    .Selection(s => s.Mode(SelectionMode.Single))
                                    .Columns(columns =>
                                    {
                                        columns.Add().DataField(nameof(FinancialPlanModel.IsSelected)).Caption("").DataType(GridColumnDataType.Boolean).Alignment(HorizontalAlignment.Center).Width(30);
                                        columns.Add().DataField(nameof(FinancialPlanModel.FinancialPlan)).Caption("Nhu cầu tài chính");
                                        columns.Add().DataField(nameof(FinancialPlanModel.NecessarySmount)).Caption("Số tiền cần thiết ước tính (VND)").DataType(GridColumnDataType.Number).Format(Format.FixedPoint).Alignment(HorizontalAlignment.Right).Width(250);
                                        columns.Add().DataField(nameof(FinancialPlanModel.CurrentAmount)).Caption("Số tiền bảo hiểm hiện có (VND)").DataType(GridColumnDataType.Number).Format(Format.FixedPoint).Alignment(HorizontalAlignment.Right).Width(250);
                                        columns.Add().DataField(nameof(FinancialPlanModel.CurrentFinancialStatus)).Caption("Nhu cầu tài chính hiện tại (VND)").DataType(GridColumnDataType.Number).Format(Format.FixedPoint).Alignment(HorizontalAlignment.Right).Width(250);
                                    })
                                    .ColumnHidingEnabled(false)
                                    .AllowColumnResizing(true)
                                    .ColumnAutoWidth(true)
                                    .ColumnMinWidth(50)
                                    .ShowRowLines(true)
                                    .FilterRow(f => f.Visible(false))
                                    .HeaderFilter(f => f.Visible(false))
                                    .GroupPanel(p => p.Visible(false))
                                    .Grouping(g => g.AutoExpandAll(false))
                                    .RemoteOperations(false)
                                    .Summary(s => s.TotalItems(items =>
                                    {
                                        items.AddFor(m => m.FinancialPlan)
                                        .SummaryType(SummaryType.Count)
                                        .ValueFormat(Format.FixedPoint)
                                        .DisplayFormat("Tổng cộng:");
                                        items.AddFor(m => m.NecessarySmount)
                                        .SummaryType(SummaryType.Sum)
                                        .ValueFormat(Format.FixedPoint)
                                        .DisplayFormat("{0}");
                                        items.AddFor(m => m.CurrentAmount)
                                        .SummaryType(SummaryType.Sum)
                                        .ValueFormat(Format.FixedPoint)
                                        .DisplayFormat("{0}");
                                        items.AddFor(m => m.CurrentFinancialStatus)
                                        .SummaryType(SummaryType.Sum)
                                        .ValueFormat(Format.FixedPoint)
                                        .DisplayFormat("{0}");
                                    }))
                                    )
                            </div>
                        </div>

                        <div class="col-12 col-sm-6 col-md-6 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().NumberBox()
                                    .ElementAttr("class", "required-validation")
                                    .Label("Phí bảo hiểm dự kiến đóng mỗi tháng (VND)").LabelMode(EditorLabelMode.Floating)
                                    .Min(0).Max(99999999999).ShowClearButton(true).Format(Format.FixedPoint)
                                    .Value(10000000))
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-6 col-lg-3 col-xl-3">
                            <div class="form-group">
                                @(Html.DevExtreme().NumberBox()
                                    .ElementAttr("class", "required-validation")
                                    .Label("Thời gian đóng phí dự kiến (Năm)").LabelMode(EditorLabelMode.Floating)
                                    .Min(0).Max(100).ShowClearButton(true).Format(Format.FixedPoint)
                                    .Value(10))
                            </div>
                        </div>
                    </div>
                </div>
                <p>
                    <a class="form-title" data-bs-toggle="collapse" href="#collapse03" role="button" aria-expanded="false" aria-controls="collapseExample">
                        <strong>C. CAM KẾT</strong>
                    </a>
                </p>
                <div class="collapse show" id="collapse03">
                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                            <div class="form-group">
                                <div>
                                    <p style="text-align: justify;">
                                        Tôi xác nhận đã đọc và trả lời các câu hỏi trên và khẳng định tất cả các thông tin trên là chính xác và đúng sự thật. Tôi hiểu rằng đây là một phần trong bộ hồ sơ yêu cầu bảo hiểm của tôi đối với Công ty TNHH Bảo hiểm Shinhan Life Việt Nam.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                            <div class="form-group">
                                @(Html.DevExtreme().CheckBox().Value(true).IconSize(18).ElementAttr("aria-label", "Custom size")
                                    .Text("Tôi/Chúng tôi xin cam kết và xác nhận."))
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row button-search-row">
                    <div class="col-md-12">
                        <button class="btn btn-purple-style" type="submit" onclick="onButtonFinancialAnalysisBackClicked()"><span class="glyphicon glyphicon-triangle-left"></span> Trở về</button>
                        <button class="btn btn-purple-style" type="submit" onclick="onButtonFinancialAnalysisNextClicked()">Lưu</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@await Html.PartialAsync("PopupChooseCustomer")

<script>
    function onButtonFinancialAnalysisBackClicked() {
        location.href = '@Url.Action("Index", "eApplication", new { area = "Management" })';
    }

    function onButtonFinancialAnalysisNextClicked() {
        location.href = '@Url.Action("Index", "Quotation", new { area = "Functions" })';
    }

    function onPopupChooseCustomerClicked() {
        $("#gridChooseCustomerList").dxDataGrid({
            dataSource: DevExpress.data.AspNet.createStore({
                loadUrl: '@Url.Action("GetCustomerList", "Customer", new { area = "Functions" })',
            }),
            showBorders: true,
            selection: {
                mode: "single"
            },
            columns: [
                { dataField: "FullName", caption: "Họ và tên", width: 200 },
                { dataField: "Gender", caption: "Giới tính", width: 100 },
                { dataField: "Birthday", caption: "Ngày sinh", dataType: "datetime", format: "dd/MM/yyyy", alignment: "center", width: 120 },
                { dataField: "HasIN", caption: "Có số định danh", dataType: "boolean", alignment: "center", width: 150 },
                { dataField: "IdentificationNumber", caption: "Số định danh", width: 120 },
                { dataField: "BirthNumber", caption: "Số giấy khai sinh", width: 150 },
                { dataField: "IdNumber", caption: "Số giấy tờ tùy thân", width: 150 },
                { dataField: "IssuedDate", caption: "Ngày cấp", dataType: "datetime", format: "dd/MM/yyyy", alignment: "center", width: 120 },
                { dataField: "IssuedPlace", caption: "Nơi cấp", dataType: "datetime", format: "dd/MM/yyyy", alignment: "center", width: 120 }
            ],
            columnHidingEnabled: true,
            allowColumnResizing: true,
            columnAutoWidth: true,
            columnMinWidth: 50,
            showRowLines: true,
            filterRow: {
                visible: true
            },
            headerFilter: {
                visible: false
            },
            groupPanel: {
                visible: false
            },
            grouping: {
                autoExpandAll: false
            },
            remoteOperations: false,
            paging: {
                pageSize: 10
            },
            pager: {
                showPageSizeSelector: true,
                allowedPageSizes: [5, 10, 20],
                showInfo: true
            }
        });

        var modal = document.getElementById("popupChooseCustomer");
        modal.classList.add("show", "in");
        modal.style.display = "block";
    }
</script>